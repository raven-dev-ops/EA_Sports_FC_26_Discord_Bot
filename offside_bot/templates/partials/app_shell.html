{% from "macros/ui.html" import badge, button, breadcrumb %}

<div class="topbar">
  <div class="flex gap-10 items-center">
    <button
      class="icon-btn"
      type="button"
      data-sidebar-toggle
      aria-label="Toggle menu"
      aria-controls="app-sidebar"
      aria-expanded="false"
    >
      &#9776;
    </button>
    <a class="brand" href="/app">
      <img class="brand-logo" src="{{ static_url('brand/logo.svg') }}" alt="Offside" width="24" height="24" />
      <span>Offside</span>
    </a>
  </div>
  <div class="flex gap-10 items-center">
    {% if guild_selector %}
      <select aria-label="Select server" onchange="window.location=this.value">
        {% for opt in guild_selector %}
          <option value="{{ opt.href }}" {% if opt.selected %}selected{% endif %}>{{ opt.label }}</option>
        {% endfor %}
      </select>
    {% endif %}
    {% if plan_badge %}{{ badge(plan_badge.label, plan_badge.kind) }}{% endif %}
    {% if install_badge %}{{ badge(install_badge.label, install_badge.kind) }}{% endif %}
  </div>
  <div class="flex gap-10 items-center">
    {% if invite_cta %}{{ button(invite_cta.label, invite_cta.href, invite_cta.variant) }}{% endif %}
    <span class="muted">{{ username }}</span>
    <a class="btn secondary" href="/logout">Logout</a>
  </div>
</div>

<div class="layout">
  <div class="sidebar-backdrop" data-sidebar-toggle aria-hidden="true"></div>
  <aside class="sidebar" id="app-sidebar" aria-label="Navigation">
    <div class="card">
      {% if nav_groups %}
        {% for group in nav_groups %}
          <div class="nav-group">
            <div class="nav-group-title">{{ group.label }}</div>
          {% for item in group["items"] %}
              <a
                class="navlink{% if item.active %} active{% endif %}{% if item.locked %} locked{% endif %}"
                href="{{ item.href }}"
                {% if item.lock_reason %}title="{{ item.lock_reason }}"{% endif %}
              >
                <span>{{ item.label }}</span>
                {% if item.locked %}
                  <span class="nav-meta">
                    <span class="muted">&#128274;</span>
                    <span class="badge pro inline">PRO</span>
                  </span>
                {% endif %}
              </a>
            {% endfor %}
          </div>
        {% endfor %}
      {% elif nav_items %}
        {% for item in nav_items %}
          <a class="navlink{% if item.active %} active{% endif %}" href="{{ item.href }}">{{ item.label }}</a>
        {% endfor %}
      {% else %}
        <div class="muted">Select a server to see modules.</div>
      {% endif %}
    </div>
  </aside>
  <main class="content">
    {% if plan_notice %}
      <div class="card">
        <div class="flex-between gap-12">
          <div>
            <div>{{ badge(plan_notice.status_label, plan_notice.status_kind) }}</div>
            <div class="mt-6"><strong>{{ plan_notice.title }}</strong></div>
            <div class="muted mt-6">{{ plan_notice.detail }}</div>
          </div>
          <div class="btn-group">
            {% for cta in plan_notice.ctas %}
              {{ button(cta.label, cta.href, cta.variant) }}
            {% endfor %}
          </div>
        </div>
      </div>
    {% endif %}
    {% if breadcrumbs %}
      {{ breadcrumb(breadcrumbs) }}
    {% endif %}
    {{ content|safe }}
  </main>
</div>
