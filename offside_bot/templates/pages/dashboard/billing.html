{% from "macros/ui.html" import badge %}

<div class="card hero-card">
  <a class="back-link" href="/app">&larr; Back</a>
  <div class="kicker mt-12">Billing</div>
  <h1 class="mt-10 text-hero-sm">Billing</h1>
  <p class="muted mt-8">Upgrade, manage subscription details, and view Stripe billing options.</p>
</div>
{% if not has_guild %}
  <p class="muted">No owned guilds found.</p>
{% else %}
  {% if status_message %}
    <div class="card"><strong>{{ status_message }}</strong></div>
  {% endif %}
  <div class="card">
    <div><strong>Current plan</strong></div>
    <div class="mt-6">{{ badge(current_plan_label, current_plan_class) }}</div>
  </div>
  {% if manage_portal %}
    <div class="card">
      <h2 class="mt-0">Manage subscription</h2>
      <p class="muted">Update payment method, view invoices, or cancel your subscription.</p>
      <form method="post" action="/app/billing/portal">
        <input type="hidden" name="csrf" value="{{ csrf_token }}" />
        <input type="hidden" name="guild_id" value="{{ guild_id }}" />
        <button class="btn secondary" type="submit">Open Stripe Billing Portal</button>
      </form>
    </div>
  {% endif %}
  <div class="card">
    <h2 class="mt-0">Upgrade this server</h2>
    <form method="post" action="/app/billing/checkout">
      <input type="hidden" name="csrf" value="{{ csrf_token }}" />
      <label><strong>Guild</strong></label>
      <select name="guild_id" class="w-full mt-6">
        {% for opt in guild_options %}
          <option value="{{ opt.value }}" {% if opt.selected %}selected{% endif %}>{{ opt.label }}</option>
        {% endfor %}
      </select>
      <label class="block mt-12"><strong>Plan</strong></label>
      <select name="plan" class="w-full mt-6">
        <option value="pro">Pro</option>
      </select>
      <div class="mt-12">
        <button class="btn blue" type="submit" {% if upgrade_disabled %}disabled{% endif %}>{{ upgrade_text }}</button>
      </div>
    </form>
  </div>
  <div class="card">
    <h2 class="mt-0">Receipts & cancellations</h2>
    <p class="muted">
      Stripe emails receipts to the billing email on file. You can cancel anytime in the billing portal and keep access
      through the end of your billing period.
    </p>
  </div>
{% endif %}
